before-aft test race condit provides-util function testing-python code fn